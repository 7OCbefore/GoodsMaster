import{r as h,e as K,g as q,i as it,h as ht,o as I,a as j,b as e,f as U,t as N,j as J,v as W,d as H,F as ct,k as ut,l as st,m as dt,p as ft,w as gt,T as pt,n as bt}from"./vue-vendor-1f2ac135.js";import{c as wt}from"./supabase-vendor-75f53c49.js";const _t="none",kt="none";let vt;vt=wt(_t,kt);const T=vt,at=h(JSON.parse(localStorage.getItem("tm_packages"))||[]),mt=h(JSON.parse(localStorage.getItem("tm_goods_list"))||[]),z=h(JSON.parse(localStorage.getItem("tm_sales_history"))||[]),yt=h(JSON.parse(localStorage.getItem("tm_sell_prices"))||{}),Z=h(new Date);K(at,i=>localStorage.setItem("tm_packages",JSON.stringify(i)),{deep:!0});K(mt,i=>localStorage.setItem("tm_goods_list",JSON.stringify(i)),{deep:!0});K(z,i=>localStorage.setItem("tm_sales_history",JSON.stringify(i)),{deep:!0});K(yt,i=>localStorage.setItem("tm_sell_prices",JSON.stringify(i)),{deep:!0});function qt(){const i=d=>Number(d).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),f=(d,o)=>{const l=new Date(d),b=new Date(o);return l.getFullYear()===b.getFullYear()&&l.getMonth()===b.getMonth()&&l.getDate()===b.getDate()},g=q(()=>{const d={};return at.value.forEach(o=>{if(!o.verified)return;const l=(o.content||"").trim();if(!l)return;d[l]||(d[l]={name:l,quantity:0,totalCost:0});const b=Number(o.quantity)||0,D=Number(o.costPrice)||0;d[l].quantity+=b,d[l].totalCost+=b*D}),z.value.forEach(o=>{o.status!=="refunded"&&o.items.forEach(l=>{if(d[l.name]){const b=d[l.name].quantity>0?d[l.name].totalCost/d[l.name].quantity:l.costSnapshot;d[l.name].quantity-=l.quantity,d[l.name].totalCost-=l.quantity*b}})}),Object.values(d).filter(o=>o.quantity>=0).map(o=>({name:o.name,quantity:o.quantity,averageCost:o.quantity>0?o.totalCost/o.quantity:0})).sort((o,l)=>l.quantity-o.quantity)}),m=q(()=>g.value.reduce((d,o)=>d+o.quantity*o.averageCost,0)),V=q(()=>g.value.reduce((d,o)=>d+o.quantity,0)),E=q(()=>{const d=Z.value,l=z.value.filter(w=>w.status!=="refunded").filter(w=>f(w.timestamp,d)),b=l.reduce((w,v)=>w+v.totalAmount,0),D=l.reduce((w,v)=>w+v.totalProfit,0),S=l.length,x=S>0?b/S:0;return{revenue:b,profit:D,count:S,aov:x,marginRate:b?(D/b*100).toFixed(1):"0.0",orders:l.sort((w,v)=>v.timestamp-w.timestamp)}}),Y=q(()=>{const d=[],o=[],l=[],b=new Date(Z.value);for(let S=6;S>=0;S--){const x=new Date(b);x.setDate(x.getDate()-S);const w=x.toLocaleDateString("zh-CN",{day:"numeric"}),v=z.value.filter(R=>R.status!=="refunded"&&f(R.timestamp,x)),O=v.reduce((R,B)=>R+B.totalProfit,0),Q=v.reduce((R,B)=>R+B.totalAmount,0);d.push({label:w,active:f(x,Z.value)}),o.push(O),l.push(Q)}const D=Math.max(...l,10);return{labels:d,values:o,revenueValues:l,max:D}}),p=q(()=>{const d={};return z.value.filter(o=>o.status!=="refunded").forEach(o=>{o.items.forEach(l=>{d[l.name]=(d[l.name]||0)+l.quantity})}),Object.entries(d).map(([o,l])=>({name:o,qty:l})).sort((o,l)=>l.qty-o.qty).slice(0,3)}),$=q(()=>g.value.filter(d=>d.quantity<10).sort((d,o)=>d.quantity-o.quantity).slice(0,3));return{packages:at,goodsList:mt,salesHistory:z,sellPrice:yt,selectedDate:Z,inventoryList:g,totalInventoryValue:m,totalInventoryCount:V,dailyStats:E,topSelling:p,lowStockItems:$,chartData:Y,formatCurrency:i,refundOrder:d=>{const o=z.value.find(l=>l.id===d);o&&(o.status="refunded")},updateOrderNote:(d,o)=>{const l=z.value.find(b=>b.id===d);l&&(l.note=o)},isSameDay:f}}const L="default-user-id";async function St(i=L){const{data:f,error:g}=await T.from("packages").select("*").eq("user_id",i).order("created_at",{ascending:!1});return{data:f,error:g}}async function Dt(i){const f={...i,user_id:i.user_id||L},{data:g,error:m}=await T.from("packages").insert([f]).select();return{data:g,error:m}}async function Ct(i,f=L){const{data:g,error:m}=await T.from("packages").update({verified:!0,verification_date:new Date().toISOString()}).eq("id",i).eq("user_id",f).select();return{data:g,error:m}}async function Pt(i,f=L){const{data:g,error:m}=await T.from("packages").delete().eq("id",i).eq("user_id",f);return{data:g,error:m}}async function Ot(i=L){const{data:f,error:g}=await T.from("goods_list").select("*").eq("user_id",i).order("name",{ascending:!0});return{data:f,error:g}}async function Ft(i=L,f,g){let m=T.from("sales_history").select("*").eq("user_id",i).order("timestamp",{ascending:!1});f&&g&&(m=m.gte("timestamp",f.toISOString()).lte("timestamp",g.toISOString()));const{data:V,error:E}=await m;return{data:V,error:E}}async function It(i){const f={...i,user_id:i.user_id||L},{data:g,error:m}=await T.from("sales_history").insert([f]).select();return{data:g,error:m}}async function jt(i,f=L){const{data:g,error:m}=await T.from("sales_history").update({status:"refunded"}).eq("id",i).eq("user_id",f).select();return{data:g,error:m}}async function Et(i=L){const{data:f,error:g}=await T.from("sell_prices").select("*").eq("user_id",i);return{data:f,error:g}}async function Ut(i){const f={...i,user_id:i.user_id||L},{data:g,error:m}=await T.from("sell_prices").upsert([f],{onConflict:"user_id,goods_name"}).select();return{data:g,error:m}}function Nt(){const i=qt(),f=h([]),g=h([]),m=h([]),V=h({}),E=h(new Date),Y=h(null),p=h(!1),$=h(null),A="default-user-id",P=()=>A,d=async(n=A)=>{p.value=!0,$.value=null;try{const[a,s,c,y]=await Promise.all([St(n),Ot(n),Ft(n),Et(n)]);if(a.error)throw a.error;if(s.error)throw s.error;if(c.error)throw c.error;if(y.error)throw y.error;f.value=a.data||[],g.value=s.data||[],m.value=c.data||[],V.value=(y.data||[]).reduce((_,F)=>(_[F.goods_name]=F.price,_),{})}catch(a){$.value=a.message,console.error("Error loading data:",a)}finally{p.value=!1}},o=q(()=>{const n={};return f.value.forEach(a=>{if(!a.verified)return;const s=(a.content||"").trim();if(!s)return;n[s]||(n[s]={name:s,quantity:0,totalCost:0});const c=Number(a.quantity)||0,y=Number(a.costPrice)||0;n[s].quantity+=c,n[s].totalCost+=c*y}),m.value.forEach(a=>{a.status!=="refunded"&&a.items.forEach(s=>{if(n[s.name]){const c=n[s.name].quantity>0?n[s.name].totalCost/n[s.name].quantity:s.costSnapshot;n[s.name].quantity-=s.quantity,n[s.name].totalCost-=s.quantity*c}})}),Object.values(n).filter(a=>a.quantity>=0).map(a=>({name:a.name,quantity:a.quantity,averageCost:a.quantity>0?a.totalCost/a.quantity:0})).sort((a,s)=>s.quantity-a.quantity)}),l=q(()=>o.value.reduce((n,a)=>n+a.quantity*a.averageCost,0)),b=q(()=>o.value.reduce((n,a)=>n+a.quantity,0)),D=(n,a)=>{const s=new Date(n),c=new Date(a);return s.getFullYear()===c.getFullYear()&&s.getMonth()===c.getMonth()&&s.getDate()===c.getDate()},S=q(()=>{const n=E.value,s=m.value.filter(C=>C.status!=="refunded").filter(C=>D(C.timestamp,n)),c=s.reduce((C,u)=>C+u.totalAmount,0),y=s.reduce((C,u)=>C+u.totalProfit,0),_=s.length,F=_>0?c/_:0;return{revenue:c,profit:y,count:_,aov:F,marginRate:c?(y/c*100).toFixed(1):"0.0",orders:s.sort((C,u)=>u.timestamp-C.timestamp)}}),x=q(()=>{const n=[],a=[],s=[],c=new Date(E.value);for(let _=6;_>=0;_--){const F=new Date(c);F.setDate(F.getDate()-_);const C=F.toLocaleDateString("zh-CN",{day:"numeric"}),u=m.value.filter(k=>k.status!=="refunded"&&D(k.timestamp,F)),t=u.reduce((k,M)=>k+M.totalProfit,0),r=u.reduce((k,M)=>k+M.totalAmount,0);n.push({label:C,active:D(F,E.value)}),a.push(t),s.push(r)}const y=Math.max(...s,10);return{labels:n,values:a,revenueValues:s,max:y}}),w=q(()=>{const n={};return m.value.filter(a=>a.status!=="refunded").forEach(a=>{a.items.forEach(s=>{n[s.name]=(n[s.name]||0)+s.quantity})}),Object.entries(n).map(([a,s])=>({name:a,qty:s})).sort((a,s)=>s.qty-a.qty).slice(0,3)}),v=q(()=>o.value.filter(n=>n.quantity<10).sort((n,a)=>n.quantity-a.quantity).slice(0,3));return{...i,packages:f,goodsList:g,salesHistory:m,sellPrice:V,selectedDate:E,user:Y,loading:p,error:$,inventoryList:o,totalInventoryValue:l,totalInventoryCount:b,dailyStats:S,topSelling:w,lowStockItems:v,chartData:x,loadData:d,addNewPackage:async n=>{const a=P();try{const s={...n,user_id:a},{data:c,error:y}=await Dt(s);if(y)throw y;return f.value.push(c[0]),i.showToast("进货成功!","success"),{data:c[0],error:null}}catch(s){return i.showToast("进货失败: "+s.message,"error"),{data:null,error:s}}},verifyExistingPackage:async n=>{const a=P();try{const{data:s,error:c}=await Ct(n,a);if(c)throw c;const y=f.value.findIndex(_=>_.id===n);return y!==-1&&(f.value[y]=s[0]),i.showToast("验证成功!","success"),{data:s[0],error:null}}catch(s){return i.showToast("验证失败: "+s.message,"error"),{data:null,error:s}}},deleteExistingPackage:async n=>{const a=P();try{const{error:s}=await Pt(n,a);if(s)throw s;const c=f.value.findIndex(y=>y.id===n);return c!==-1&&f.value.splice(c,1),i.showToast("删除成功!","success"),{error:null}}catch(s){return i.showToast("删除失败: "+s.message,"error"),{error:s}}},recordSale:async n=>{const a=P();try{const s={...n,user_id:a},{data:c,error:y}=await It(s);if(y)throw y;return m.value.push(c[0]),i.showToast("销售记录成功!","success"),{data:c[0],error:null}}catch(s){return i.showToast("销售记录失败: "+s.message,"error"),{data:null,error:s}}},refundExistingOrder:async n=>{const a=P();try{const{data:s,error:c}=await jt(n,a);if(c)throw c;const y=m.value.findIndex(_=>_.id===n);return y!==-1&&(m.value[y]=s[0]),i.showToast("退款成功!","success"),{data:s[0],error:null}}catch(s){return i.showToast("退款失败: "+s.message,"error"),{data:null,error:s}}},setSellPriceForGood:async(n,a)=>{const s=P();try{const c={user_id:s,goods_name:n,price:parseFloat(a)},{data:y,error:_}=await Ut(c);if(_)throw _;return V.value[n]=parseFloat(a),i.showToast("售价设置成功!","success"),{data:y[0],error:null}}catch(c){return i.showToast("售价设置失败: "+c.message,"error"),{data:null,error:c}}},isSameDay:D}}const Tt={class:"flex flex-col h-full bg-surface pt-safe pb-[80px]"},Lt={class:"px-5 py-4 flex justify-between items-end bg-surface sticky top-0 z-10"},Vt={class:"flex bg-gray-200/50 p-1 rounded-lg"},$t={class:"px-5 mb-4"},At={class:"bg-white rounded-xl flex items-center px-3 py-2.5 shadow-sm"},Rt={class:"flex-1 overflow-y-auto px-5 space-y-3 pb-24 hide-scrollbar"},Mt={key:0,class:"flex flex-col items-center py-20 opacity-40"},zt={class:"flex justify-between items-start mb-2"},Bt={class:"font-bold text-lg text-primary"},Jt={class:"bg-secondary/10 text-secondary px-2 py-0.5 rounded text-xs font-bold"},Wt={class:"flex items-center gap-2 mb-3"},Yt={class:"font-mono text-xs bg-gray-100 px-1.5 py-0.5 rounded text-gray-500"},Gt=["onClick"],Ht={class:"font-bold"},Kt={class:"flex gap-3 pt-3 border-t border-gray-50"},Qt=["onClick"],Xt=["onClick"],Zt={class:"fixed bottom-24 right-5 flex flex-col gap-4 z-40"},te={key:0,class:"fixed inset-0 z-50 bg-surface flex flex-col justify-center"},ee={class:"bg-white shadow-sm pt-safe"},se={class:"px-6 py-4 flex justify-between items-center"},ae={class:"p-5 flex-1 overflow-y-auto"},re={class:"mb-4 bg-[#0A84FF] rounded-2xl p-4 border border-blue-200"},ne={class:"flex items-center justify-between"},oe={key:0,class:"flex gap-3 mb-6"},le={class:"flex-1 bg-white h-28 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center justify-center text-accent active:bg-blue-50 transition-colors relative"},ie={class:"flex-1 bg-white h-28 rounded-2xl border border-gray-100 shadow-sm p-3 flex flex-col justify-between"},ce={key:1,class:"mb-6 bg-white rounded-2xl p-6 shadow-sm border border-dashed border-gray-200"},ue={key:2,class:"mb-6 bg-white rounded-2xl p-2 shadow-sm max-h-32 overflow-y-auto"},de={class:"font-mono font-bold"},fe=["onClick"],ge={class:"bg-white rounded-2xl p-4 shadow-sm space-y-4"},pe={class:"flex gap-4"},ve={class:"flex-1"},me={class:"flex-1"},ye={key:0,class:"fixed inset-0 z-[60] bg-black flex flex-col pt-safe"},xe={class:"px-4 py-4 flex justify-between items-center z-10 min-h-[48px] flex-shrink-0"},he={class:"bg-black/40 backdrop-blur px-3 py-1 rounded-full text-white text-xs font-bold border border-white/10"},be={class:"flex-1 relative"},we={key:0,class:"absolute bottom-20 left-0 w-full flex justify-center"},_e={__name:"InboxView",setup(i){const f=Nt(),{packages:g,goodsList:m,addNewPackage:V,verifyExistingPackage:E,deleteExistingPackage:Y}=f,p=it("showToast"),$=it("showDialog"),A=h("pending"),P=h(""),d=q(()=>{let u=g.value.filter(t=>A.value==="pending"?!t.verified:t.verified);if(P.value){const t=P.value.toUpperCase();u=u.filter(r=>r.tracking.includes(t)||r.content.includes(t))}return u.sort((t,r)=>r.timestamp-t.timestamp)}),o=q(()=>g.value.filter(u=>!u.verified).length),l=async u=>{if(u.verified)$({title:"撤销入库",content:"确定要撤销这条记录的入库状态吗？",isDanger:!0,action:async()=>{p("已撤销","warning")}});else{const t=await E(u.id);t.error?p("入库失败: "+t.error.message,"error"):p("已入库")}},b=u=>{$({title:"删除记录",content:"此操作不可恢复，确定删除？",isDanger:!0,action:async()=>{const t=await Y(u);t.error?p("删除失败: "+t.error.message,"error"):p("已删除")}})},D=u=>{$({title:"修改进价",content:`货物：${u.content}`,isInput:!0,inputValue:u.costPrice>0?u.costPrice:"",action:t=>{const r=parseFloat(t);if(isNaN(r)||r<0)return p("价格无效","warning");u.costPrice=r,p("价格已更新")}})},S=h(!1),x=h([]),w=h(""),v=ht({content:"",quantity:"1",costPrice:"",note:""});h(!1);const O=h(!1),Q=()=>{if(w.value.length<4)return p("单号至少4位","warning");if(x.value.includes(w.value))return p("单号已存在","warning");x.value.push(w.value),w.value=""},R=()=>`DIRECT_${Date.now()}`,B=()=>{const u=R();if(x.value.includes(u))return p("单号已存在","warning");x.value.push(u)},rt=async u=>{const t=u.target.files[0];if(t){p("正在识别条形码...","info");try{if(!("BarcodeDetector"in window)){p("当前浏览器不支持条形码识别","warning");return}const r=await BarcodeDetector.getSupportedFormats();if(!r||r.length===0){p("当前浏览器不支持条形码识别","warning");return}const k=new BarcodeDetector({formats:r.filter(tt=>["qr_code","code_128","ean_13","ean_8","data_matrix"].includes(tt))}),M=new Image,X=URL.createObjectURL(t);await new Promise((tt,ot)=>{M.onload=async()=>{try{const G=await k.detect(M);if(G.length>0){let et=0;G.forEach(xt=>{const lt=xt.rawValue;x.value.includes(lt)||(x.value.push(lt),et++)}),et>0?p(`识别成功: 新增${et}个单号`,"success"):p("识别成功: 但单号已存在","warning")}else p("未识别到条形码，请确保图片清晰且包含有效条形码","warning");URL.revokeObjectURL(X),tt()}catch(G){console.error("条形码识别错误:",G),p("识别失败，请重试","error"),URL.revokeObjectURL(X),ot(G)}},M.onerror=()=>{URL.revokeObjectURL(X),p("图片加载失败","error"),ot(new Error("图片加载失败"))},M.src=X})}catch(r){console.error("处理图片时发生错误:",r),r.message!=="图片加载失败"&&p("处理图片时发生错误","error")}}};K(()=>v.content,u=>{if(!u)return;const t=g.value.find(r=>r.content===u&&r.costPrice>0);t&&(v.costPrice=t.costPrice)});const nt=async()=>{if(!v.content)return p("请填写货名","warning");if(O.value&&x.value.length===0&&B(),x.value.length===0)return p("请添加至少一个单号","warning");Date.now().toString();for(const u of x.value){const t={tracking:u,content:v.content,quantity:parseInt(v.quantity)||1,costPrice:parseFloat(v.costPrice)||0,note:v.note,verified:!!O.value,timestamp:Date.now()},r=await V(t);if(r.error){p("录入失败: "+r.error.message,"error");return}}p(`成功录入 ${x.value.length} 条${O.value?"（已自动入库）":""}`),x.value=[],v.content="",v.quantity="1",v.costPrice="",v.note="",S.value=!1},n=h(!1),a=h(null),s=h(null);let c=null;const y=async()=>{if(!navigator.mediaDevices||!window.BarcodeDetector)return p("设备不支持扫码","error");n.value=!0;try{c=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),await bt(),a.value.srcObject=c,a.value.play(),_()}catch{p("摄像头启动失败","error"),n.value=!1}},_=async()=>{if(n.value){try{const t=await new BarcodeDetector().detect(a.value);t.length>0&&F(t[0].rawValue)}catch{}requestAnimationFrame(_)}},F=u=>{if(s.value)return;const t=u.toUpperCase(),r=g.value.find(k=>!k.verified&&(k.tracking===t||t.endsWith(k.tracking)));r?(r.verified=!0,s.value={type:"success",msg:`${r.content} x${r.quantity}
(${r.tracking}) 已入库`},navigator.vibrate&&navigator.vibrate(100),setTimeout(()=>s.value=null,1500)):(s.value={type:"error",msg:"未找到该包裹"},navigator.vibrate&&navigator.vibrate(300),setTimeout(()=>s.value=null,1500))},C=()=>{n.value=!1,c&&c.getTracks().forEach(u=>u.stop())};return(u,t)=>(I(),j("div",Tt,[e("header",Lt,[t[11]||(t[11]=e("h1",{class:"text-[32px] font-bold text-primary tracking-tight"},"进货管理",-1)),e("div",Vt,[e("button",{onClick:t[0]||(t[0]=r=>A.value="pending"),class:U([A.value==="pending"?"bg-white shadow text-primary":"text-gray-500","px-3 py-1 text-xs font-bold rounded-md transition-all"])},"待收 "+N(o.value),3),e("button",{onClick:t[1]||(t[1]=r=>A.value="verified"),class:U([A.value==="verified"?"bg-white shadow text-primary":"text-gray-500","px-3 py-1 text-xs font-bold rounded-md transition-all"])},"已收",2)])]),e("div",$t,[e("div",At,[t[12]||(t[12]=e("i",{class:"ph ph-magnifying-glass text-gray-400 text-lg mr-2"},null,-1)),J(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>P.value=r),placeholder:"搜索单号或货名",class:"flex-1 bg-transparent outline-none text-sm font-bold placeholder-gray-300 text-primary"},null,512),[[W,P.value]])])]),e("div",Rt,[d.value.length===0?(I(),j("div",Mt,[...t[13]||(t[13]=[e("i",{class:"ph ph-package text-4xl mb-2"},null,-1),e("span",{class:"text-sm font-bold"},"暂无数据",-1)])])):H("",!0),(I(!0),j(ct,null,ut(d.value,r=>(I(),j("div",{key:r.id,class:"bg-white p-4 rounded-2xl shadow-sm active:scale-[0.98] transition-transform border border-gray-50"},[e("div",zt,[e("div",Bt,N(r.content),1),e("span",Jt,"x"+N(r.quantity),1)]),e("div",Wt,[e("span",Yt,N(r.tracking),1),e("button",{onClick:st(k=>D(r),["stop"]),class:U(["flex items-center gap-1 text-xs px-2 py-0.5 rounded transition-colors",r.costPrice>0?"bg-orange-50 text-orange-600":"bg-red-50 text-red-500 animate-pulse"])},[t[14]||(t[14]=e("i",{class:"ph-bold ph-tag"},null,-1)),e("span",Ht,N(r.costPrice>0?`¥${r.costPrice}`:"补填进价"),1)],10,Gt)]),e("div",Kt,[e("button",{onClick:st(k=>l(r),["stop"]),class:U(["flex-1 py-2.5 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition-colors",r.verified?"bg-gray-100 text-gray-500":"bg-[#0A84FF] text-white shadow-lg shadow-blue-500/30"])},[e("i",{class:U(r.verified?"ph-bold ph-arrow-u-up-left":"ph-bold ph-check")},null,2),dt(" "+N(r.verified?"撤销":"确认收货"),1)],10,Qt),e("button",{onClick:st(k=>b(r.id),["stop"]),class:"w-12 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400 active:text-red-500"},[...t[15]||(t[15]=[e("i",{class:"ph-bold ph-trash text-lg"},null,-1)])],8,Xt)])]))),128))]),e("div",Zt,[e("button",{onClick:y,class:"w-14 h-14 bg-white rounded-full shadow-xl border border-gray-100 flex items-center justify-center text-primary active:scale-90 transition-transform"},[...t[16]||(t[16]=[e("i",{class:"ph-bold ph-scan text-2xl"},null,-1)])]),e("button",{onClick:t[3]||(t[3]=r=>S.value=!0),class:"w-14 h-14 bg-[#0A84FF] rounded-full shadow-2xl shadow-blue-500/40 flex items-center justify-center text-white active:scale-90 transition-transform"},[...t[17]||(t[17]=[e("i",{class:"ph-bold ph-plus text-2xl"},null,-1)])])]),ft(pt,{name:"fade"},{default:gt(()=>[S.value?(I(),j("div",te,[e("div",ee,[e("div",se,[e("button",{onClick:t[4]||(t[4]=r=>S.value=!1),class:"text-gray-400 font-bold min-h-[28px] flex items-center"},"取消"),t[18]||(t[18]=e("span",{class:"font-bold text-lg"},"批量录入",-1)),e("button",{onClick:nt,class:U([x.value.length||O.value&&v.content?"text-accent":"text-gray-300","font-bold min-h-[28px] flex items-center"])},"保存 ("+N(x.value.length)+")",3)])]),e("div",ae,[e("div",re,[e("div",ne,[t[19]||(t[19]=e("div",{class:"flex items-center gap-3"},[e("i",{class:"ph-bold ph-lightning text-xl text-white"}),e("div",null,[e("div",{class:"font-bold text-white"},"直入模式"),e("div",{class:"text-xs text-white/70 mt-0.5"},"自动生成单号并直接入库")])],-1)),e("button",{onClick:t[5]||(t[5]=r=>O.value=!O.value),class:U(["relative w-12 h-7 rounded-full transition-colors",O.value?"bg-white":"bg-white/30"])},[e("div",{class:U(["absolute top-1 w-5 h-5 rounded-full shadow-md transition-transform",O.value?"left-6 bg-[#0A84FF]":"left-1 bg-white"])},null,2)],2)])]),O.value?(I(),j("div",ce,[...t[22]||(t[22]=[e("div",{class:"text-center"},[e("i",{class:"ph-bold ph-check-circle text-4xl text-success mb-2"}),e("div",{class:"font-bold text-primary mb-1"},"直入模式已开启"),e("div",{class:"text-xs text-gray-500"},"填写货物信息后将自动生成单号并入库")],-1)])])):(I(),j("div",oe,[e("div",le,[t[20]||(t[20]=e("i",{class:"ph-bold ph-camera text-3xl mb-1"},null,-1)),t[21]||(t[21]=e("span",{class:"text-xs font-bold"},"相册识别",-1)),e("input",{type:"file",accept:"image/*",class:"absolute inset-0 opacity-0",onChange:rt},null,32)]),e("div",ie,[J(e("input",{"onUpdate:modelValue":t[6]||(t[6]=r=>w.value=r),placeholder:"输入后4位",class:"text-center font-mono font-bold text-xl outline-none placeholder-gray-200 text-primary uppercase",maxlength:"10"},null,512),[[W,w.value]]),e("button",{onClick:Q,class:"bg-[#0A84FF] text-white text-xs font-bold py-2 rounded-lg"},"手动添加")])])),x.value.length?(I(),j("div",ue,[(I(!0),j(ct,null,ut(x.value,(r,k)=>(I(),j("div",{key:k,class:"flex justify-between p-3 border-b border-gray-50 last:border-0"},[e("span",de,N(r),1),e("button",{onClick:M=>x.value.splice(k,1),class:"text-gray-300"},[...t[23]||(t[23]=[e("i",{class:"ph-bold ph-x"},null,-1)])],8,fe)]))),128))])):H("",!0),e("div",ge,[e("div",null,[t[24]||(t[24]=e("label",{class:"text-xs font-bold text-gray-400 uppercase ml-1"},"货名",-1)),J(e("input",{"onUpdate:modelValue":t[7]||(t[7]=r=>v.content=r),placeholder:"例如：黄鹤楼",class:"w-full bg-gray-50 p-3 rounded-xl mt-1 font-bold outline-none focus:ring-2 focus:ring-accent/20"},null,512),[[W,v.content]])]),e("div",pe,[e("div",ve,[t[25]||(t[25]=e("label",{class:"text-xs font-bold text-gray-400 uppercase ml-1"},"数量",-1)),J(e("input",{"onUpdate:modelValue":t[8]||(t[8]=r=>v.quantity=r),type:"tel",class:"w-full bg-gray-50 p-3 rounded-xl mt-1 font-bold text-center outline-none"},null,512),[[W,v.quantity]])]),e("div",me,[t[26]||(t[26]=e("label",{class:"text-xs font-bold text-gray-400 uppercase ml-1"},"单价",-1)),J(e("input",{"onUpdate:modelValue":t[9]||(t[9]=r=>v.costPrice=r),type:"tel",placeholder:"0.00",class:"w-full bg-gray-50 p-3 rounded-xl mt-1 font-bold text-center outline-none text-orange-600"},null,512),[[W,v.costPrice]])])]),e("div",null,[t[27]||(t[27]=e("label",{class:"text-xs font-bold text-gray-400 uppercase ml-1"},"备注",-1)),J(e("input",{"onUpdate:modelValue":t[10]||(t[10]=r=>v.note=r),class:"w-full bg-gray-50 p-3 rounded-xl mt-1 font-bold outline-none text-sm"},null,512),[[W,v.note]])])])])])):H("",!0)]),_:1}),ft(pt,{name:"fade"},{default:gt(()=>[n.value?(I(),j("div",ye,[e("div",xe,[e("div",he,"待收: "+N(o.value),1),e("button",{onClick:C,class:"w-10 h-10 bg-white/20 backdrop-blur rounded-full flex items-center justify-center text-white"},[...t[28]||(t[28]=[e("i",{class:"ph-bold ph-x text-xl"},null,-1)])])]),e("div",be,[e("video",{ref_key:"videoRef",ref:a,class:"w-full h-full object-cover opacity-80"},null,512),t[29]||(t[29]=e("div",{class:"absolute inset-0 flex items-center justify-center"},[e("div",{class:"w-64 h-48 border-2 border-white/30 rounded-3xl relative overflow-hidden shadow-[0_0_0_100vh_rgba(0,0,0,0.5)]"},[e("div",{class:"absolute inset-x-0 h-0.5 bg-accent top-0 scan-line shadow-[0_0_20px_#0A84FF]"})])],-1)),s.value?(I(),j("div",we,[e("div",{class:U(["px-6 py-3 rounded-full font-bold shadow-xl flex items-center gap-2",s.value.type==="success"?"bg-success text-white":"bg-danger text-white"]),style:{"white-space":"pre-line"}},[e("i",{class:U(s.value.type==="success"?"ph-bold ph-check":"ph-bold ph-warning")},null,2),dt(" "+N(s.value.msg),1)],2)])):H("",!0)])])):H("",!0)]),_:1})]))}},Se=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{Se as I,Nt as u};
